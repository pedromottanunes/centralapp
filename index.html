<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Central de Controle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <!-- (Seu CSS aqui, n√£o foi alterado) -->
    <style>
        /* ... Seu CSS completo, igual ao original ... */
    </style>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3576f6">
</head>
<body>
    <!-- ... Seu HTML completo, igual ao original ... -->
    <div class="header">
        <div class="logo">
            <img src="https://drive.google.com/thumbnail?id=1xG9c2LJaXOM6O6vLhU-8zt_rTl272tbg" alt="Logo da empresa" style="width: 100%; height: 100%; object-fit: contain;">
        </div>
        <div class="header-title">Central de Opera√ß√µes</div>
        <div style="margin-top:4px; font-size:1rem; font-weight:300; color:#c2cbd6;">
            Acesse as principais fun√ß√µes habilitadas
        </div>
    </div>
    <div class="central-container">
      <div class="button-panel">
        <!-- Linha 1: Gravar Reuni√£o + pasta -->
        <div class="btn-row">
          <button class="central-btn" onclick="abrirGravador()">
            <img src="https://drive.google.com/thumbnail?id=18w8uXoehDkLb59OjpriJfYBd-unkZXp_" class="btn-icon" alt="√çcone"> Gravar Reuni√£o
          </button>
          <div class="icon-wrapper" style="position: relative; display: inline-block;">
            <img src="https://drive.google.com/thumbnail?id=1ptE3YOWy4ZhkbeBK89wz4C1bTG0rfdgi" class="icon-label-absolute" alt="√çcone Resultados" title="Abaixo est√£o as respectivas pastas que cont√©m os resultados j√° automatizados" />
            <button class="btn-mini" onclick="abrirPastasReunioes()" title="Ver atas/relat√≥rios de reuni√µes">üìÇ</button>
          </div>
        </div>
        <!-- Linha 2: Ler Projetos + pasta -->
        <div class="btn-row">
          <button class="central-btn" onclick="abrirLerProjeto()">
            <img src="https://drive.google.com/thumbnail?id=1nPWGBHim9p3EWUDIPn7XlBOHQ0tj4Hak" class="btn-icon" alt="√çcone"> Ler Projetos
          </button>
          <button class="btn-mini" onclick="abrirPastasProjetos()" title="Ver relat√≥rios de projetos">üìÇ</button>
        </div>
        <!-- Linha 3: Fazer Or√ßamento (placeholder √† direita) -->
        <div class="btn-row">
          <button class="central-btn" onclick="orcamento()">
            <img src="https://drive.google.com/thumbnail?id=107tCtV7tjLjhVAxqMDkqikmL01dw-_0c" class="btn-icon" alt="√çcone"> Fazer Or√ßamento
          </button>
          <span class="btn-mini-placeholder"></span>
        </div>
        <!-- Linha 4: Login com google (placeholder √† direita) -->
        <div class="btn-row">
          <button class="central-btn" id="btnGoogleAuth" onclick="googleSignIn()">
            <img src="https://drive.google.com/thumbnail?id=1QcnOm_G-NjTtV8SLHd3rKwrHk2yWE3F1" class="btn-icon" alt="√çcone"> Login
          </button>
          <span class="btn-mini-placeholder"></span>
        </div>
        <div class="btn-row" style="display:none;" id="rowGoogleOut">
          <button class="central-btn" id="btnGoogleOut" onclick="googleSignOut()">Sair do Google</button>
          <span class="btn-mini-placeholder"></span>
        </div>
      </div>
      <div id="userEmail"></div>
      <div id="authStatus" style="font-size:0.95rem;color:#2254a6;margin-top:8px;"></div>
    </div>

    <!-- Modais mantidos, igual seu c√≥digo -->
    <!-- ... modais ... -->

    <div class="footer-logo">
        <img src="https://drive.google.com/thumbnail?id=1W-wgNX7l3z3lqfIvhyqigqIIvH1E9M0L" alt="Logo Rodap√©">
    </div>

<script>
/* CONFIGS ‚Äì TROQUE para os seus: */
const CLIENT_ID = '206253858878-rdmme43csja9vuicd6uh4so1cgfg3v0u.apps.googleusercontent.com';
const API_KEY = 'AIzaSyDSQt5SOwfXOKuMasPUShacyHmsjzObDnA';
const SCOPES = 'https://www.googleapis.com/auth/drive.file';

const PASTA_ATAS_ID = '13LyjSc_52aYD6Tr1JsDd266fDLNbUj4A';
const PASTA_RELATORIOS_ID = '1Q-xMsOfm47M0kuyS0AdKSmDt5J0D4UAK';

let accessToken = '';
let tokenClient = null;
let userEmail = '';

window.onload = function() {
    gapi.load('client', () => {
        gapi.client.init({apiKey: API_KEY});
    });
    tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: handleTokenResponse,
    });
};

// FUN√á√ïES DOS BOT√ïES PRINCIPAIS

// ---- OR√áAMENTO (pode ser um modal ou um alert tempor√°rio) ----
function orcamento() {
    alert('Funcionalidade de or√ßamento em desenvolvimento!');
}

// =============== GRAVADOR ===============
let mediaRecorder, audioChunks = [], audioBlob;
const modal = document.getElementById('modalGravador');
const btnGravar = document.getElementById('btnGravar');
const btnPausar = document.getElementById('btnPausar');
const btnParar = document.getElementById('btnParar');
const audioPlayer = document.getElementById('audioPlayer');
const btnUpload = document.getElementById('btnUpload');
const statusMsg = document.getElementById('statusMsg');
let audioBlobGlobal = null;

function abrirGravador() {
    modal.classList.add('open');
    resetarGravador();
}
function fecharGravador() {
    if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
    }
    modal.classList.remove('open');
    resetarGravador();
}
function iniciarGravacao() {
    if (!navigator.mediaDevices || !window.MediaRecorder) {
        alert("Seu navegador n√£o suporta grava√ß√£o de √°udio!");
        return;
    }
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];
        mediaRecorder.ondataavailable = e => { if (e.data.size > 0) audioChunks.push(e.data); };
        mediaRecorder.onstart = () => {
            btnGravar.disabled = true;
            btnPausar.disabled = false;
            btnParar.disabled = false;
            statusMsg.textContent = 'Gravando...';
            audioPlayer.style.display = 'none';
            btnUpload.style.display = 'none';
        };
        mediaRecorder.onpause = () => { statusMsg.textContent = 'Grava√ß√£o pausada.'; };
        mediaRecorder.onresume = () => { statusMsg.textContent = 'Gravando...'; };
        mediaRecorder.onstop = () => {
            audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            blobToWav(audioBlob).then(wavBlob => {
                audioPlayer.src = URL.createObjectURL(wavBlob);
                audioPlayer.style.display = 'block';
                btnUpload.style.display = 'block';
                statusMsg.textContent = 'Grava√ß√£o finalizada. Clique em "Salvar no Google Drive".';
                audioBlobGlobal = wavBlob;
                stream.getTracks().forEach(track => track.stop());
            }).catch(() => {
                audioPlayer.src = URL.createObjectURL(audioBlob);
                audioPlayer.style.display = 'block';
                btnUpload.style.display = 'block';
                statusMsg.textContent = 'Grava√ß√£o finalizada (WEBM). Clique em "Salvar no Google Drive".';
                audioBlobGlobal = audioBlob;
                stream.getTracks().forEach(track => track.stop());
            });
        };
        mediaRecorder.start();
    }).catch(err => {
        statusMsg.textContent = 'Erro ao acessar o microfone: ' + err.message;
        alert('Erro ao acessar o microfone: ' + err.message);
    });
}
function pausarGravacao() {
    if (!mediaRecorder) return;
    if (mediaRecorder.state === 'recording') {
        mediaRecorder.pause();
        btnPausar.textContent = "‚ñ∂Ô∏è Retomar";
        statusMsg.textContent = 'Grava√ß√£o pausada.';
    } else if (mediaRecorder.state === 'paused') {
        mediaRecorder.resume();
        btnPausar.textContent = "‚è∏Ô∏è Pausar";
        statusMsg.textContent = 'Gravando...';
    }
}
function pararGravacao() {
    if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
        btnGravar.disabled = false;
        btnPausar.disabled = true;
        btnPausar.textContent = "‚è∏Ô∏è Pausar";
        btnParar.disabled = true;
    }
}
function resetarGravador() {
    btnGravar.disabled = false;
    btnPausar.disabled = true;
    btnPausar.textContent = "‚è∏Ô∏è Pausar";
    btnParar.disabled = true;
    audioPlayer.src = "";
    audioPlayer.style.display = 'none';
    btnUpload.style.display = 'none';
    statusMsg.textContent = '';
    audioBlobGlobal = null;
}

// =============== LOGIN GOOGLE ===============
function googleSignIn() {
    tokenClient.requestAccessToken();
}
function handleTokenResponse(tokenResponse) {
    if (tokenResponse && tokenResponse.access_token) {
        accessToken = tokenResponse.access_token;
        document.getElementById('authStatus').textContent = "Google Drive conectado.";
        document.getElementById('btnGoogleAuth').style.display = 'none';
        document.getElementById('rowGoogleOut').style.display = '';
        getUserEmail();
    } else {
        document.getElementById('authStatus').textContent = "Erro na autentica√ß√£o.";
    }
}
function googleSignOut() {
    accessToken = '';
    document.getElementById('authStatus').textContent = "Fa√ßa login para salvar no Google Drive.";
    document.getElementById('btnGoogleAuth').style.display = '';
    document.getElementById('rowGoogleOut').style.display = 'none';
    document.getElementById('userEmail').textContent = '';
}
async function getUserEmail() {
    if (!accessToken) return;
    try {
        const resp = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
            headers: {'Authorization': 'Bearer ' + accessToken}
        });
        const data = await resp.json();
        if (data.email) document.getElementById('userEmail').textContent = data.email;
    } catch {}
}

// =============== UPLOAD PDF ===============
const modalLerProjeto = document.getElementById('modalLerProjeto');
const inputPdf = document.getElementById('inputPdf');
const pdfFileName = document.getElementById('pdfFileName');
const btnUploadPdf = document.getElementById('btnUploadPdf');
const statusMsgPdf = document.getElementById('statusMsgPdf');
let pdfBlobGlobal = null;

function abrirLerProjeto() {
    modalLerProjeto.classList.add('open');
    resetarLerProjeto();
}
function fecharLerProjeto() {
    modalLerProjeto.classList.remove('open');
    resetarLerProjeto();
}
function resetarLerProjeto() {
    inputPdf.value = "";
    pdfFileName.textContent = "";
    btnUploadPdf.style.display = 'none';
    statusMsgPdf.textContent = "";
    pdfBlobGlobal = null;
}

inputPdf.onchange = function() {
    const file = inputPdf.files[0];
    if (file && file.type === "application/pdf") {
        pdfFileName.textContent = "Selecionado: " + file.name;
        btnUploadPdf.style.display = 'block';
        pdfBlobGlobal = file;
    } else {
        pdfFileName.textContent = "Selecione um arquivo PDF v√°lido.";
        btnUploadPdf.style.display = 'none';
        pdfBlobGlobal = null;
    }
};

async function salvarPdfNoDrive() {
    if (!accessToken) {
        alert("Voc√™ precisa conectar com o Google Drive antes de salvar.");
        return;
    }
    if (!pdfBlobGlobal) {
        alert("Nenhum PDF selecionado.");
        return;
    }
    statusMsgPdf.textContent = 'Enviando PDF para o Google Drive...';
    const metadata = {
        name: "projeto_" + new Date().toISOString().replace(/[:.]/g,'_') + ".pdf",
        mimeType: pdfBlobGlobal.type,
        parents: [PASTA_RELATORIOS_ID]
    };
    const form = new FormData();
    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
    form.append('file', pdfBlobGlobal);

    try {
        const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,webViewLink', {
            method: 'POST',
            headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
            body: form,
        });
        const result = await response.json();
        if(result.id){
            statusMsgPdf.innerHTML = 'PDF enviado! <a href="https://drive.google.com/file/d/' + result.id + '/view" target="_blank">Abrir arquivo</a>';
        }else{
            statusMsgPdf.textContent = 'Falha ao enviar: ' + (result.error && result.error.message ? result.error.message : 'Erro desconhecido');
        }
    } catch(e){
        statusMsgPdf.textContent = 'Erro na conex√£o com o Google Drive.';
    }
}

// =============== PASTAS DE REUNI√ïES E PROJETOS ===============
function abrirPastasReunioes() {
    document.getElementById('modalPastaReunioes').classList.add('open');
    listarArquivosReunioes();
}
function fecharPastasReunioes() {
    document.getElementById('modalPastaReunioes').classList.remove('open');
    document.getElementById('listaArquivosReunioes').innerHTML = "";
    document.getElementById('statusMsgReunioes').textContent = "";
}
async function listarArquivosReunioes() {
    if (!accessToken) {
        document.getElementById('statusMsgReunioes').textContent = 'Conecte com o Google Drive.';
        return;
    }
    document.getElementById('statusMsgReunioes').textContent = 'Carregando arquivos...';
    try {
        const resp = await fetch(
            `https://www.googleapis.com/drive/v3/files?q='${PASTA_ATAS_ID}'+in+parents+and+(mimeType='application/pdf'+or+mimeType='text/html')&fields=files(id,name,mimeType,webViewLink,createdTime)&orderBy=createdTime+desc`,
            { headers: { 'Authorization': 'Bearer ' + accessToken } }
        );
        const data = await resp.json();
        if (data.files && data.files.length > 0) {
            document.getElementById('statusMsgReunioes').textContent = '';
            let html = '<ul style="list-style:none;padding:0;">';
            data.files.forEach(arq => {
                const icon = arq.mimeType === "application/pdf" ? "üìÑ" : "üåê";
                html += `<li style="margin-bottom:12px;">
                    ${icon} <a href="${arq.webViewLink}" target="_blank" style="font-size:1.05rem;">${arq.name}</a>
                    <span style="color:#9bbdfa; font-size:0.92rem;"> (${new Date(arq.createdTime).toLocaleString()})</span>
                </li>`;
            });
            html += '</ul>';
            document.getElementById('listaArquivosReunioes').innerHTML = html;
        } else {
            document.getElementById('listaArquivosReunioes').innerHTML = "";
            document.getElementById('statusMsgReunioes').textContent = 'Nenhum relat√≥rio encontrado.';
        }
    } catch (e) {
        document.getElementById('statusMsgReunioes').textContent = 'Erro ao buscar arquivos.';
    }
}

function abrirPastasProjetos() {
    document.getElementById('modalPastaProjetos').classList.add('open');
    listarArquivosProjetos();
}
function fecharPastasProjetos() {
    document.getElementById('modalPastaProjetos').classList.remove('open');
    document.getElementById('listaArquivosProjetos').innerHTML = "";
    document.getElementById('statusMsgProjetos').textContent = "";
}
async function listarArquivosProjetos() {
    if (!accessToken) {
        document.getElementById('statusMsgProjetos').textContent = 'Conecte com o Google Drive.';
        return;
    }
    document.getElementById('statusMsgProjetos').textContent = 'Carregando arquivos...';
    try {
        const resp = await fetch(
            `https://www.googleapis.com/drive/v3/files?q='${PASTA_RELATORIOS_ID}'+in+parents+and+(mimeType='application/pdf'+or+mimeType='text/html')&fields=files(id,name,mimeType,webViewLink,createdTime)&orderBy=createdTime+desc`,
            { headers: { 'Authorization': 'Bearer ' + accessToken } }
        );
        const data = await resp.json();
        if (data.files && data.files.length > 0) {
            document.getElementById('statusMsgProjetos').textContent = '';
            let html = '<ul style="list-style:none;padding:0;">';
            data.files.forEach(arq => {
                const icon = arq.mimeType === "application/pdf" ? "üìÑ" : "üåê";
                html += `<li style="margin-bottom:12px;">
                    ${icon} <a href="${arq.webViewLink}" target="_blank" style="font-size:1.05rem;">${arq.name}</a>
                    <span style="color:#9bbdfa; font-size:0.92rem;"> (${new Date(arq.createdTime).toLocaleString()})</span>
                </li>`;
            });
            html += '</ul>';
            document.getElementById('listaArquivosProjetos').innerHTML = html;
        } else {
            document.getElementById('listaArquivosProjetos').innerHTML = "";
            document.getElementById('statusMsgProjetos').textContent = 'Nenhum relat√≥rio encontrado.';
        }
    } catch (e) {
        document.getElementById('statusMsgProjetos').textContent = 'Erro ao buscar arquivos.';
    }
}
</script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
      .then(function() {
        console.log('Service Worker registrado');
      });
  }
</script>
</body>
</html>
