<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Central de Controle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #f6f8fc 0%, #e9f3fd 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
//COLOCAR BACKGROUND
body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 50%;
    //background-image: url('https://drive.google.com/thumbnail?id=17RaYYpYzA-Nlm9dGhbp1NanG7-e96-3y');
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    opacity: 0.3;
    z-index: 0;
    pointer-events: none;
}


//CONFIGURAÇÃO DO RODAPÉ
.footer-logo {
    margin-top: 40px;
    margin-bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: center;
    z-index: 1;
}

.footer-logo img {
    max-height: 50px;
    opacity: 0.7;
}

        .btn-icon {
    width: 33px;
    height: 33px;
    margin-right: 3px;
    object-fit: contain;
}

        
        .header { width: 100%; background: #232b36; color: #fff; padding: 24px 0 18px 0;
            display: flex; flex-direction: column; align-items: center;
            border-bottom-left-radius: 32px; border-bottom-right-radius: 32px;
            box-shadow: 0 4px 24px 0 rgba(0,0,0,0.05);}
        .logo { width: 64px; height: 64px; margin-bottom: 8px; border-radius: 16px;
            background: #fff; display: flex; align-items: center; justify-content: center; overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);}
        .header-title { font-size: 2rem; font-weight: 600; letter-spacing: 1px; margin-bottom: 2px;}
        .central-container { flex: 1; width: 100%; max-width: 400px; display: flex; flex-direction: column;
            align-items: center; padding: 20px 16px 0 16px;}
        .button-panel { width: 100%; display: flex; flex-direction: column; gap: 18px; margin-top: 12px; align-items: center;}
        
     .central-btn { 
width: 75%; 
padding: 18px 0; 
background: #3576f6; 
color: #fff; 
font-size: 1.2rem; 
font-weight: 500;
border: none; 
border-radius: 25px;
box-shadow: 0 2px 16px 0 rgba(53,118,246,0.10);
cursor: pointer;
transition: background 0.2s, transform 0.1s; 
display: flex; 
align-items: center;
justify-content: flex-start; /* <-- Isso alinha o conteúdo à esquerda */
    gap: 14px; /* Distância entre ícone e texto */
    position: relative;
    padding-left: 32px; /* Espaço extra para o ícone não ficar colado na borda */
}

.btn-icon {
    width: 28px;
    height: 28px;
    margin-right: 10px;
    object-fit: contain;
    flex-shrink: 0; /* Mantém o ícone fixo, sem esticar ou encolher */
}







        
        .central-btn:hover { background: #2254a6; transform: translateY(-2px) scale(1.03);}
        .central-btn[disabled]{opacity:0.6;cursor:not-allowed;}
        #userEmail {font-size: 0.98rem; margin-bottom: 8px; color: #2c62a6;}
        @media (max-width: 600px) {
            .header-title { font-size: 1.4rem; }
            .central-container { padding-top: 10px; max-width: 100%; }
            .button-panel { gap: 12px; margin-top: 8px; }
        }
        .modal-bg {display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.45); z-index: 99; justify-content: center; align-items: center;}
        .modal-bg.open { display: flex;}
        .modal-gravador {background: #fff; padding: 28px 24px 24px 24px; border-radius: 20px; box-shadow: 0 2px 24px 0 rgba(40,70,140,0.15);
            min-width: 300px; min-height: 210px; display: flex; flex-direction: column; align-items: center; gap: 16px; position: relative; max-width: 95vw;}
        .close-btn { position: absolute; right: 14px; top: 14px; background: transparent; border: none; font-size: 1.5rem; color: #888; cursor: pointer;}
        .gravador-btns {display: flex; gap: 16px; margin-top: 6px;}
        .gravador-btns button { background: #3576f6; color: #fff; border: none; border-radius: 12px; padding: 12px 18px;
            font-size: 1.2rem; cursor: pointer; box-shadow: 0 2px 8px 0 rgba(53,118,246,0.10); transition: background 0.18s;}
        .gravador-btns button:disabled { background: #9bbdfa; cursor: not-allowed;}
        .audio-player {width: 100%; margin-top: 10px;}
        .status-msg {font-size: 1rem; color: #2254a6; margin-top: 5px;}
    </style>





<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#3576f6">

    





    
</head>
<body>
    <div class="header">
        <div class="logo">
            <img src="https://drive.google.com/thumbnail?id=1xG9c2LJaXOM6O6vLhU-8zt_rTl272tbg" alt="Logo da empresa" style="width: 100%; height: 100%; object-fit: contain;">
        </div>
        <div class="header-title">Central de Operações</div>
        <div style="margin-top:4px; font-size:1rem; font-weight:300; color:#c2cbd6;">
            Acesse as principais funções habilitadas
        </div>
    </div>
    <div class="central-container">
      <div class="button-panel">
          
<button class="central-btn" onclick="abrirGravador()">
    <img src="https://drive.google.com/thumbnail?id=18w8uXoehDkLb59OjpriJfYBd-unkZXp_" class="btn-icon" alt="Ícone"> Gravar Reunião</button>
      
      <button class="central-btn" onclick="abrirLerProjeto()">
    <img src="https://drive.google.com/thumbnail?id=1nPWGBHim9p3EWUDIPn7XlBOHQ0tj4Hak" class="btn-icon" alt="Ícone"> Ler Projetos </button>


  <button class="central-btn" onclick="orcamento()">
    <img src="https://drive.google.com/thumbnail?id=107tCtV7tjLjhVAxqMDkqikmL01dw-_0c" class="btn-icon" alt="Ícone"> Fazer Orçamento </button>

          
        <button class="central-btn" id="btnGoogleAuth" onclick="googleSignIn()">
    <img src="https://drive.google.com/thumbnail?id=1QcnOm_G-NjTtV8SLHd3rKwrHk2yWE3F1" class="btn-icon" alt="Ícone"> Login com Google </button>
        <button class="central-btn" id="btnGoogleOut" onclick="googleSignOut()" style="display:none;">Sair do Google</button>
      </div>
      <div id="userEmail"></div>
      <div id="authStatus" style="font-size:0.95rem;color:#2254a6;margin-top:8px;"></div>
    </div>
    <!-- MODAL GRAVADOR DE ÁUDIO -->
    <div class="modal-bg" id="modalGravador">
        <div class="modal-gravador">
            <button class="close-btn" onclick="fecharGravador()">&times;</button>
            <h3>Gravador de Áudio</h3>
            <div class="gravador-btns">
                <button id="btnGravar" onclick="iniciarGravacao()">⏺️ Gravar</button>
                <button id="btnPausar" onclick="pausarGravacao()" disabled>⏸️ Pausar</button>
                <button id="btnParar" onclick="pararGravacao()" disabled>⏹️ Parar</button>
            </div>
            <audio id="audioPlayer" class="audio-player" controls style="display:none;"></audio>
            <button id="btnUpload" class="central-btn" style="width:100%;display:none;" onclick="salvarNoDrive()">Salvar no Google Drive</button>
            <div id="statusMsg" class="status-msg"></div>
        </div>
    </div>
    <!-- MODAL LER PROJETOS (PDF) -->
    <div class="modal-bg" id="modalLerProjeto">
        <div class="modal-gravador">
            <button class="close-btn" onclick="fecharLerProjeto()">&times;</button>
            <h3>Carregar Projeto (PDF)</h3>
            <input type="file" id="inputPdf" accept="application/pdf" style="margin-bottom:16px;">
            <div id="pdfFileName" style="font-size:1rem; color:#2254a6;"></div>
            <button id="btnUploadPdf" class="central-btn" style="width:100%; display:none;" onclick="salvarPdfNoDrive()">Salvar PDF no Google Drive</button>
            <div id="statusMsgPdf" class="status-msg"></div>
        </div>
    </div>
<script>
/* CONFIGS – TROQUE para os seus: */
const CLIENT_ID = '206253858878-rdmme43csja9vuicd6uh4so1cgfg3v0u.apps.googleusercontent.com';
const API_KEY = 'AIzaSyDSQt5SOwfXOKuMasPUShacyHmsjzObDnA';
const SCOPES = 'https://www.googleapis.com/auth/drive.file';

let accessToken = '';
let tokenClient = null;
let userEmail = '';

window.onload = function() {
    gapi.load('client', () => {
        gapi.client.init({apiKey: API_KEY});
    });
    tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: handleTokenResponse,
    });
};

function googleSignIn() {
    tokenClient.requestAccessToken();
}
function handleTokenResponse(tokenResponse) {
    if (tokenResponse && tokenResponse.access_token) {
        accessToken = tokenResponse.access_token;
        document.getElementById('authStatus').textContent = "Google Drive conectado.";
        document.getElementById('btnGoogleAuth').style.display = 'none';
        document.getElementById('btnGoogleOut').style.display = '';
        getUserEmail();
    } else {
        document.getElementById('authStatus').textContent = "Erro na autenticação.";
    }
}
function googleSignOut() {
    accessToken = '';
    document.getElementById('authStatus').textContent = "Faça login para salvar no Google Drive.";
    document.getElementById('btnGoogleAuth').style.display = '';
    document.getElementById('btnGoogleOut').style.display = 'none';
    document.getElementById('userEmail').textContent = '';
}
async function getUserEmail() {
    if (!accessToken) return;
    try {
        const resp = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
            headers: {'Authorization': 'Bearer ' + accessToken}
        });
        const data = await resp.json();
        if (data.email) document.getElementById('userEmail').textContent = data.email;
    } catch {}
}

// =============== Gravador de Áudio ===============
let mediaRecorder, audioChunks = [], audioBlob;
const modal = document.getElementById('modalGravador');
const btnGravar = document.getElementById('btnGravar');
const btnPausar = document.getElementById('btnPausar');
const btnParar = document.getElementById('btnParar');
const audioPlayer = document.getElementById('audioPlayer');
const btnUpload = document.getElementById('btnUpload');
const statusMsg = document.getElementById('statusMsg');
let audioBlobGlobal = null;

function abrirGravador() {
    modal.classList.add('open');
    resetarGravador();
}
function fecharGravador() {
    if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
    }
    modal.classList.remove('open');
    resetarGravador();
}
function iniciarGravacao() {
    if (!navigator.mediaDevices || !window.MediaRecorder) {
        alert("Seu navegador não suporta gravação de áudio!");
        return;
    }
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];
        mediaRecorder.ondataavailable = e => { if (e.data.size > 0) audioChunks.push(e.data); };
        mediaRecorder.onstart = () => {
            btnGravar.disabled = true;
            btnPausar.disabled = false;
            btnParar.disabled = false;
            statusMsg.textContent = 'Gravando...';
            audioPlayer.style.display = 'none';
            btnUpload.style.display = 'none';
        };
        mediaRecorder.onpause = () => { statusMsg.textContent = 'Gravação pausada.'; };
        mediaRecorder.onresume = () => { statusMsg.textContent = 'Gravando...'; };
        mediaRecorder.onstop = () => {
            audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            blobToWav(audioBlob).then(wavBlob => {
                audioPlayer.src = URL.createObjectURL(wavBlob);
                audioPlayer.style.display = 'block';
                btnUpload.style.display = 'block';
                statusMsg.textContent = 'Gravação finalizada. Clique em "Salvar no Google Drive".';
                audioBlobGlobal = wavBlob;
                stream.getTracks().forEach(track => track.stop());
            }).catch(() => {
                audioPlayer.src = URL.createObjectURL(audioBlob);
                audioPlayer.style.display = 'block';
                btnUpload.style.display = 'block';
                statusMsg.textContent = 'Gravação finalizada (WEBM). Clique em "Salvar no Google Drive".';
                audioBlobGlobal = audioBlob;
                stream.getTracks().forEach(track => track.stop());
            });
        };
        mediaRecorder.start();
    }).catch(err => {
        statusMsg.textContent = 'Erro ao acessar o microfone: ' + err.message;
        alert('Erro ao acessar o microfone: ' + err.message);
    });
}
function pausarGravacao() {
    if (!mediaRecorder) return;
    if (mediaRecorder.state === 'recording') {
        mediaRecorder.pause();
        btnPausar.textContent = "▶️ Retomar";
        statusMsg.textContent = 'Gravação pausada.';
    } else if (mediaRecorder.state === 'paused') {
        mediaRecorder.resume();
        btnPausar.textContent = "⏸️ Pausar";
        statusMsg.textContent = 'Gravando...';
    }
}
function pararGravacao() {
    if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
        btnGravar.disabled = false;
        btnPausar.disabled = true;
        btnPausar.textContent = "⏸️ Pausar";
        btnParar.disabled = true;
    }
}
function resetarGravador() {
    btnGravar.disabled = false;
    btnPausar.disabled = true;
    btnPausar.textContent = "⏸️ Pausar";
    btnParar.disabled = true;
    audioPlayer.src = "";
    audioPlayer.style.display = 'none';
    btnUpload.style.display = 'none';
    statusMsg.textContent = '';
    audioBlobGlobal = null;
}

// =============== Salvar no Google Drive (áudio) ===============
async function salvarNoDrive() {
    if (!accessToken) {
        alert("Você precisa conectar com o Google Drive antes de salvar.");
        return;
    }
    if (!audioBlobGlobal) {
        alert("Nenhum áudio para enviar.");
        return;
    }
    statusMsg.textContent = 'Enviando para o Google Drive...';
    const metadata = {
        name: "gravacao_" + new Date().toISOString().replace(/[:.]/g,'_') + ".wav",
        mimeType: audioBlobGlobal.type,
    };
    const form = new FormData();
    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
    form.append('file', audioBlobGlobal);

    try {
        const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,webViewLink', {
            method: 'POST',
            headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
            body: form,
        });
        const result = await response.json();
        if(result.id){
            statusMsg.innerHTML = 'Enviado para o Google Drive! <a href="https://drive.google.com/file/d/' + result.id + '/view" target="_blank">Abrir arquivo</a>';
        }else{
            statusMsg.textContent = 'Falha ao enviar: ' + (result.error && result.error.message ? result.error.message : 'Erro desconhecido');
        }
    } catch(e){
        statusMsg.textContent = 'Erro na conexão com o Google Drive.';
    }
}

// =============== Conversão para WAV ===============
function blobToWav(blob) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            audioContext.decodeAudioData(reader.result).then(audioBuffer => {
                const wavBuffer = encodeWAV(audioBuffer);
                resolve(new Blob([wavBuffer], { type: 'audio/wav' }));
            }).catch(reject);
        };
        reader.onerror = reject;
        reader.readAsArrayBuffer(blob);
    });
}
function encodeWAV(audioBuffer) {
    const numChannels = audioBuffer.numberOfChannels;
    const sampleRate = audioBuffer.sampleRate;
    const samples = audioBuffer.getChannelData(0);
    const buffer = new ArrayBuffer(44 + samples.length * 2);
    const view = new DataView(buffer);
    function writeString(view, offset, string) {
        for (let i = 0; i < string.length; i++) {
            view.setUint8(offset + i, string.charCodeAt(i));
        }
    }
    writeString(view, 0, 'RIFF');
    view.setUint32(4, 36 + samples.length * 2, true);
    writeString(view, 8, 'WAVE');
    writeString(view, 12, 'fmt ');
    view.setUint32(16, 16, true);
    view.setUint16(20, 1, true);
    view.setUint16(22, numChannels, true);
    view.setUint32(24, sampleRate, true);
    view.setUint32(28, sampleRate * numChannels * 2, true);
    view.setUint16(32, numChannels * 2, true);
    view.setUint16(34, 16, true);
    writeString(view, 36, 'data');
    view.setUint32(40, samples.length * 2, true);
    let offset = 44;
    for (let i = 0; i < samples.length; i++, offset += 2) {
        let s = Math.max(-1, Math.min(1, samples[i]));
        view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
    }
    return buffer;
}

// =============== Ler Projetos (Upload PDF) ===============
const modalLerProjeto = document.getElementById('modalLerProjeto');
const inputPdf = document.getElementById('inputPdf');
const pdfFileName = document.getElementById('pdfFileName');
const btnUploadPdf = document.getElementById('btnUploadPdf');
const statusMsgPdf = document.getElementById('statusMsgPdf');
let pdfBlobGlobal = null;

function abrirLerProjeto() {
    modalLerProjeto.classList.add('open');
    resetarLerProjeto();
}
function fecharLerProjeto() {
    modalLerProjeto.classList.remove('open');
    resetarLerProjeto();
}
function resetarLerProjeto() {
    inputPdf.value = "";
    pdfFileName.textContent = "";
    btnUploadPdf.style.display = 'none';
    statusMsgPdf.textContent = "";
    pdfBlobGlobal = null;
}

// Quando escolher o arquivo PDF, mostrar nome e liberar botão upload
inputPdf.onchange = function() {
    const file = inputPdf.files[0];
    if (file && file.type === "application/pdf") {
        pdfFileName.textContent = "Selecionado: " + file.name;
        btnUploadPdf.style.display = 'block';
        pdfBlobGlobal = file;
    } else {
        pdfFileName.textContent = "Selecione um arquivo PDF válido.";
        btnUploadPdf.style.display = 'none';
        pdfBlobGlobal = null;
    }
};

// Função upload PDF
async function salvarPdfNoDrive() {
    if (!accessToken) {
        alert("Você precisa conectar com o Google Drive antes de salvar.");
        return;
    }
    if (!pdfBlobGlobal) {
        alert("Nenhum PDF selecionado.");
        return;
    }
    statusMsgPdf.textContent = 'Enviando PDF para o Google Drive...';
    const metadata = {
        name: "projeto_" + new Date().toISOString().replace(/[:.]/g,'_') + ".pdf",
        mimeType: pdfBlobGlobal.type,
    };
    const form = new FormData();
    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
    form.append('file', pdfBlobGlobal);

    try {
        const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,webViewLink', {
            method: 'POST',
            headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
            body: form,
        });
        const result = await response.json();
        if(result.id){
            statusMsgPdf.innerHTML = 'PDF enviado! <a href="https://drive.google.com/file/d/' + result.id + '/view" target="_blank">Abrir arquivo</a>';
        }else{
            statusMsgPdf.textContent = 'Falha ao enviar: ' + (result.error && result.error.message ? result.error.message : 'Erro desconhecido');
        }
    } catch(e){
        statusMsgPdf.textContent = 'Erro na conexão com o Google Drive.';
    }
}
</script>


    <div class="footer-logo">
    <img src="https://drive.google.com/thumbnail?id=1W-wgNX7l3z3lqfIvhyqigqIIvH1E9M0L" alt="Logo Rodapé">
</div>











<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
      .then(function() {
        console.log('Service Worker registrado');
      });
  }
</script>





    
</body>
</html>
